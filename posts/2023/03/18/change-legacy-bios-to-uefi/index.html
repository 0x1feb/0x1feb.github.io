<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Legacy BIOS を UEFI に変更する | 0x1feb</title><meta name=keywords content="Windows 10,Windows 11"><meta name=description content="背景 Windows 10 から Windows 11 にアップグレードしたい。 Windows 11 のシステム要件であるセキュアブートを満たしていなかった。 Legacy BIOS で Windows 10 をインストールしていた。 Windows 10 が"><meta name=author content="Me"><link rel=canonical href=https://0x1feb.github.io/posts/2023/03/18/change-legacy-bios-to-uefi/><link crossorigin=anonymous href=/assets/css/stylesheet.f31506494d50c1e73c10e63d252a2d8a2cb329e28c1402c71fee0d3145ad3685.css integrity="sha256-8xUGSU1Qwec8EOY9JSotiiyzKeKMFALHH+4NMUWtNoU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://0x1feb.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://0x1feb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://0x1feb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://0x1feb.github.io/apple-touch-icon.png><link rel=mask-icon href=https://0x1feb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Legacy BIOS を UEFI に変更する"><meta property="og:description" content="背景 Windows 10 から Windows 11 にアップグレードしたい。 Windows 11 のシステム要件であるセキュアブートを満たしていなかった。 Legacy BIOS で Windows 10 をインストールしていた。 Windows 10 が"><meta property="og:type" content="article"><meta property="og:url" content="https://0x1feb.github.io/posts/2023/03/18/change-legacy-bios-to-uefi/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-18T12:29:36+09:00"><meta property="article:modified_time" content="2023-03-18T12:29:36+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Legacy BIOS を UEFI に変更する"><meta name=twitter:description content="背景 Windows 10 から Windows 11 にアップグレードしたい。 Windows 11 のシステム要件であるセキュアブートを満たしていなかった。 Legacy BIOS で Windows 10 をインストールしていた。 Windows 10 が"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://0x1feb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Legacy BIOS を UEFI に変更する","item":"https://0x1feb.github.io/posts/2023/03/18/change-legacy-bios-to-uefi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Legacy BIOS を UEFI に変更する","name":"Legacy BIOS を UEFI に変更する","description":"背景 Windows 10 から Windows 11 にアップグレードしたい。 Windows 11 のシステム要件であるセキュアブートを満たしていなかった。 Legacy BIOS で Windows 10 をインストールしていた。 Windows 10 が","keywords":["Windows 10","Windows 11"],"articleBody":"背景  Windows 10 から Windows 11 にアップグレードしたい。 Windows 11 のシステム要件であるセキュアブートを満たしていなかった。  Legacy BIOS で Windows 10 をインストールしていた。 Windows 10 が MBR ディスクにインストールされているため、 UEFI を有効にしても Legacy BIOS で起動してしまう。   マザーボードは PRIME B350-PLUS (BIOS Version 6061) を使用している。  概要  Windows 10 がインストールされているドライブが MBR ディスクになっているため、 GPT ディスクに変換する。 BIOS の設定を Legacy Boot から UEFI に変更する。  手順 MBR ディスクを GPT ディスクに変換する   Windows 10 の回復オプションを開く。（開き方は以下など）\n 「設定  更新とセキュリティ  回復  今すぐ再起動」をクリックする。 「Shift」キーを押しながら「再起動」ボタンをクリックする。    「トラブルシューティング  詳細オプション  コマンドプロンプト」をクリックする。\n  diskpart コマンドで対象ディスクの GPT に * がついていないことを確認する。\n diskpart DISKPART list disk ディスク 状態 サイズ 空き ダイナ GPT ### ミック ------------ ------------- ------- ------- --- --- ディスク 0 オンライン 489 GB 3072 KB ディスク 1 オンライン 3726 GB 1024 KB * ディスク 2 オンライン 3725 GB 0 B * DISKPART exit   mbr2gpt コマンドで対象の MBR ディスクを GPT ディスクに変換する。\n mbr2gpt /validate /disk:0 /allowFULLOS MBR2GPT: Attempting to validate disk 0 MBR2GPT: Retrieving layout of disk MBR2GPT: Validating layout, disk sector size is: 512 bytes MBR2GPT: Validation completed successfully  mbr2gpt /convert /disk:0 /allowFullOS MBR2GPT will now attempt to convert disk 0. If conversion is successful the disk can only be booted in GPT mode. These changes cannot be undone! MBR2GPT: Attempting to convert disk 0 MBR2GPT: Retrieving layout of disk MBR2GPT: Validating layout, disk sector size is: 512 bytes MBR2GPT: Trying to shrink the OS partition MBR2GPT: Creating the EFI system partition MBR2GPT: Installing the new boot files MBR2GPT: Performing the layout conversion MBR2GPT: Migrating default boot entry MBR2GPT: Adding recovery boot entry MBR2GPT: Fixing drive letter mapping MBR2GPT: Conversion completed successfully Call WinReReapir to repair WinRE MBR2GPT: Failed to update ReAgent.xml, please try to manually disable and enable WinRE. MBR2GPT: Before the new system can boot properly you need to switch the firmware to boot to UEFI mode! Failed to update ReAgent.xml, please try to manually disable and enable WinRE. というエラーが出ていたが、無視しても特に問題なかった。 手動で WinRE の無効化と有効化を実行する場合は、以下コマンドを実行する。\n reagentc /disable REAGENTC.EXE: Operation Successful.  reagentc /enable REAGENTC.EXE: Operation Successful.   再起動して BIOS のブートオプションを変更する。\n  BIOS のブートオプションを設定する   再起動して「F2」キーをクリックし、 BIOS の設定画面を開く。\n  UEFI モードで起動するように以下2箇所を設定して保存する。\n 「Boot  Secure Boot  OS Type」: Windows UEFI mode 「Boot  CSM  Launch CSM」: Disabled    Windows 10 が起動したら、 PowerShell で以下コマンドを実行し、 UEFI が有効になっていることを確認する。\n Confirm-SecureBootUEFI True   ","wordCount":"880","inLanguage":"en","datePublished":"2023-03-18T12:29:36+09:00","dateModified":"2023-03-18T12:29:36+09:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0x1feb.github.io/posts/2023/03/18/change-legacy-bios-to-uefi/"},"publisher":{"@type":"Organization","name":"0x1feb","logo":{"@type":"ImageObject","url":"https://0x1feb.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=https://0x1feb.github.io/ accesskey=h title="0x1feb (Alt + H)">0x1feb</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://0x1feb.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://0x1feb.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://0x1feb.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://0x1feb.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://0x1feb.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://0x1feb.github.io/posts/>Posts</a></div><h1 class=post-title>Legacy BIOS を UEFI に変更する</h1><div class=post-meta><span title="2023-03-18 12:29:36 +0900 +0900">2023-03-18</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/0x1feb/0x1feb-blog/blob/main/content/posts/2023/03/18/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%83%8c%e6%99%af aria-label=背景>背景</a></li><li><a href=#%e6%a6%82%e8%a6%81 aria-label=概要>概要</a></li><li><a href=#%e6%89%8b%e9%a0%86 aria-label=手順>手順</a><ul><li><a href=#mbr-%e3%83%87%e3%82%a3%e3%82%b9%e3%82%af%e3%82%92-gpt-%e3%83%87%e3%82%a3%e3%82%b9%e3%82%af%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b aria-label="MBR ディスクを GPT ディスクに変換する">MBR ディスクを GPT ディスクに変換する</a></li><li><a href=#bios-%e3%81%ae%e3%83%96%e3%83%bc%e3%83%88%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%99%e3%82%8b aria-label="BIOS のブートオプションを設定する">BIOS のブートオプションを設定する</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=背景>背景<a hidden class=anchor aria-hidden=true href=#背景>#</a></h2><ul><li>Windows 10 から Windows 11 にアップグレードしたい。</li><li>Windows 11 のシステム要件であるセキュアブートを満たしていなかった。<ul><li>Legacy BIOS で Windows 10 をインストールしていた。</li><li>Windows 10 が MBR ディスクにインストールされているため、 UEFI を有効にしても Legacy BIOS で起動してしまう。</li></ul></li><li>マザーボードは <a href=https://www.asus.com/jp/motherboards-components/motherboards/prime/prime-b350-plus/>PRIME B350-PLUS</a> (BIOS Version 6061) を使用している。</li></ul><h2 id=概要>概要<a hidden class=anchor aria-hidden=true href=#概要>#</a></h2><ul><li>Windows 10 がインストールされているドライブが MBR ディスクになっているため、 GPT ディスクに変換する。</li><li>BIOS の設定を Legacy Boot から UEFI に変更する。</li></ul><h2 id=手順>手順<a hidden class=anchor aria-hidden=true href=#手順>#</a></h2><h3 id=mbr-ディスクを-gpt-ディスクに変換する>MBR ディスクを GPT ディスクに変換する<a hidden class=anchor aria-hidden=true href=#mbr-ディスクを-gpt-ディスクに変換する>#</a></h3><ol><li><p>Windows 10 の回復オプションを開く。（開き方は以下など）</p><ul><li>「設定 > 更新とセキュリティ > 回復 > 今すぐ再起動」をクリックする。</li><li>「Shift」キーを押しながら「再起動」ボタンをクリックする。</li></ul></li><li><p>「トラブルシューティング > 詳細オプション > コマンドプロンプト」をクリックする。</p></li><li><p><code>diskpart</code> コマンドで対象ディスクの GPT に <code>*</code> がついていないことを確認する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; diskpart
   
DISKPART&gt; list disk
   
  ディスク      状態           サイズ   空き   ダイナ GPT
  <span style=color:#75715e>###                                          ミック</span>
  ------------  -------------  -------  -------  ---  ---
  ディスク <span style=color:#ae81ff>0</span>    オンライン           <span style=color:#ae81ff>489</span> GB  <span style=color:#ae81ff>3072</span> KB        
  ディスク <span style=color:#ae81ff>1</span>    オンライン          <span style=color:#ae81ff>3726</span> GB  <span style=color:#ae81ff>1024</span> KB        *
  ディスク <span style=color:#ae81ff>2</span>    オンライン          <span style=color:#ae81ff>3725</span> GB      <span style=color:#ae81ff>0</span> B        *
   
DISKPART&gt; exit
   
</code></pre></div></li><li><p><code>mbr2gpt</code> コマンドで対象の MBR ディスクを GPT ディスクに変換する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; mbr2gpt /validate /disk:0 /allowFULLOS

MBR2GPT: Attempting to validate disk <span style=color:#ae81ff>0</span>
MBR2GPT: Retrieving layout of disk
MBR2GPT: Validating layout, disk sector size is: <span style=color:#ae81ff>512</span> bytes
MBR2GPT: Validation completed successfully

&gt; mbr2gpt /convert /disk:0 /allowFullOS

MBR2GPT will now attempt to convert disk 0.
If conversion is successful the disk can only be booted in GPT mode.
These changes cannot be undone!

MBR2GPT: Attempting to convert disk <span style=color:#ae81ff>0</span>
MBR2GPT: Retrieving layout of disk
MBR2GPT: Validating layout, disk sector size is: <span style=color:#ae81ff>512</span> bytes
MBR2GPT: Trying to shrink the OS partition
MBR2GPT: Creating the EFI system partition
MBR2GPT: Installing the new boot files
MBR2GPT: Performing the layout conversion
MBR2GPT: Migrating default boot entry
MBR2GPT: Adding recovery boot entry
MBR2GPT: Fixing drive letter mapping
MBR2GPT: Conversion completed successfully
Call WinReReapir to repair WinRE
MBR2GPT: Failed to update ReAgent.xml, please try to  manually disable and enable WinRE.
MBR2GPT: Before the new system can boot properly you need to switch the firmware to boot to UEFI mode!
</code></pre></div><p><code>Failed to update ReAgent.xml, please try to manually disable and enable WinRE.</code> というエラーが出ていたが、無視しても特に問題なかった。
手動で WinRE の無効化と有効化を実行する場合は、以下コマンドを実行する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; reagentc /disable
REAGENTC.EXE: Operation Successful.

&gt; reagentc /enable
REAGENTC.EXE: Operation Successful.
</code></pre></div></li><li><p>再起動して BIOS のブートオプションを変更する。</p></li></ol><h3 id=bios-のブートオプションを設定する>BIOS のブートオプションを設定する<a hidden class=anchor aria-hidden=true href=#bios-のブートオプションを設定する>#</a></h3><ol><li><p>再起動して「F2」キーをクリックし、 BIOS の設定画面を開く。</p></li><li><p>UEFI モードで起動するように以下2箇所を設定して保存する。</p><ul><li>「Boot > Secure Boot > OS Type」: Windows UEFI mode</li><li>「Boot > CSM > Launch CSM」: Disabled</li></ul></li><li><p>Windows 10 が起動したら、 PowerShell で以下コマンドを実行し、 UEFI が有効になっていることを確認する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; Confirm-SecureBootUEFI
True
</code></pre></div></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://0x1feb.github.io/tags/windows-10/>Windows 10</a></li><li><a href=https://0x1feb.github.io/tags/windows-11/>Windows 11</a></li></ul><nav class=paginav><a class=next href=https://0x1feb.github.io/posts/2023/02/16/backet-sort/><span class=title>Next »</span><br><span>バケットソート (Bucket Sort)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://0x1feb.github.io/>0x1feb</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerHTML='copy';function copyingDone(){copybutton.innerHTML='copied!';setTimeout(()=>{copybutton.innerHTML='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>